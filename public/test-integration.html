<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Integración Chat + Formulario</title>
    <base href="https://aipps.ca/">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test de Integración: Chat + Formulario AIPPS</h1>
        
        <div class="test-section">
            <h2>Estado de la Página</h2>
            <div id="page-status"></div>
        </div>

        <div class="test-section">
            <h2>Scripts Detectados</h2>
            <div id="scripts-status"></div>
        </div>

        <div class="test-section">
            <h2>Formulario AIPPS</h2>
            <div id="aipps-form-container"></div>
        </div>

        <div class="test-section">
            <h2>Console Logs</h2>
            <div id="console-logs" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Scripts de AIPPS -->
    <script src="embed.js?key=ac1b29fdd5b0e1e207bb3b71cc6cd2b1d0cf356c1ffa6c74"></script>
    <script src="static/form-embed.js?id=48"></script>

    <script>
        // Interceptar console.log para mostrar en pantalla
        const originalLog = console.log;
        const logsContainer = document.getElementById('console-logs');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ' - ' + args.join(' ');
            logEntry.style.marginBottom = '2px';
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        };

        // Función para verificar el estado
        function checkStatus() {
            const pageStatus = document.getElementById('page-status');
            const scriptsStatus = document.getElementById('scripts-status');
            
            // Verificar scripts
            const chatScript = document.querySelector('script[src*="embed.js"]');
            const formScript = document.querySelector('script[src*="form-embed.js"]');
            
            let scriptsHtml = '';
            if (chatScript) {
                scriptsHtml += '<div class="info">✓ Script de Chat detectado</div>';
            }
            if (formScript) {
                scriptsHtml += '<div class="info">✓ Script de Formulario detectado</div>';
            }
            scriptsStatus.innerHTML = scriptsHtml;

            // Verificar elementos en la página
            const chatWidget = document.getElementById('aipi-widget-container');
            const formContainer = document.getElementById('aipps-form-container');
            const formActive = document.documentElement.hasAttribute('data-aipps-form-active');
            
            let statusHtml = '';
            
            if (formActive) {
                statusHtml += '<div class="success">✓ Formulario marcado como activo</div>';
            }
            
            if (chatWidget) {
                const isVisible = chatWidget.style.display !== 'none' && 
                                getComputedStyle(chatWidget).display !== 'none';
                if (isVisible) {
                    statusHtml += '<div class="warning">⚠️ Widget de chat visible (NO debería estar visible)</div>';
                } else {
                    statusHtml += '<div class="success">✓ Widget de chat oculto correctamente</div>';
                }
            } else {
                statusHtml += '<div class="success">✓ Widget de chat no inicializado (correcto)</div>';
            }
            
            if (formContainer && formContainer.innerHTML.trim()) {
                statusHtml += '<div class="success">✓ Formulario cargado correctamente</div>';
            }
            
            pageStatus.innerHTML = statusHtml;
        }

        // Verificar estado cada 2 segundos
        setInterval(checkStatus, 2000);
        
        // Verificación inicial después de que todo se cargue
        setTimeout(() => {
            console.log('=== INICIANDO VERIFICACIÓN DE INTEGRACIÓN ===');
            checkStatus();
        }, 2000);
    </script>
</body>
</html>
